"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.template = void 0;
const typescript_1 = __importDefault(require("typescript"));
const null_transformation_context_1 = require("../transformation/null-transformation-context");
function template(str, languageVersion = typescript_1.default.ScriptTarget.ESNext, scriptKind = typescript_1.default.ScriptKind.TS) {
    const source = typescript_1.default.createSourceFile('%%template%%', str, languageVersion, true, scriptKind);
    return (options) => {
        const transformed = typescript_1.default.visitEachChild(source, visitor, null_transformation_context_1.nullTransformationContext);
        return transformed.statements;
        function visitor(node) {
            markNodeSynthesized(node);
            if (!typescript_1.default.isIdentifier(node)) {
                return typescript_1.default.visitEachChild(node, visitor, null_transformation_context_1.nullTransformationContext);
            }
            const replacement = options[node.text];
            if (replacement == null) {
                return node;
            }
            return replacement;
        }
    };
}
exports.template = template;
function markNodeSynthesized(_node) {
    const node = _node;
    node.pos = -1;
    node.end = -1;
    node.flags |= typescript_1.default.NodeFlags.Synthesized;
}
//# sourceMappingURL=index.js.map